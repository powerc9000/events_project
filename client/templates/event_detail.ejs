<div class="container mx-auto content" data-controller="event-detail">
  <div class="flex items-center">
    <h1 class="font-bold text-3xl"><%=event.name%></h1>
    <div class="ml-4">
      <%if(canEdit){%>
      <a
        href="/events/<%=event.slug%>/edit"
        class="text-blue-500 hover:underline"
        >Edit</a
      >
      <%}%>
    </div>
  </div>
  <h2 class="text-lg">
    <span class="font-bold">Location:</span> <%=event.location%>
  </h2>
  <div class="text-lg">
    <span
      data-controller="format-date"
      data-format-date-epoch="<%=event.date%>"
      data-target="format-date.date"
      ><%=new Date(event.date)%></span
    >
  </div>

  <div class="mt-2">
    <span class="p-1 bg-green-500 mr-2">
      <%=event.going.length%> Attending
    </span>
    <span class="p-1 bg-gray-300 mr-2">
      <%=event.invited.length%> Invited
    </span>
    <%if(canInvite){%>
    <button
      href="#"
      class="bg-black text-white hover:underline p-1"
      data-action="event-detail#toggleInviteForm"
    >
      Invite People
    </button>
    <%}%>
  </div>
  <form
    class="hidden p-4 bg-green-200 mt-4"
    data-target="event-detail.inviteForm"
    data-action="event-detail#sendInvite"
  >
    <div class="my-2">
      <%-include("partials/form_messages", {id:"invite"})%>
    </div>
    <input type="hidden" name="eventId" value="<%=event.id%>" />
    <div class="flex flex-col">
      <label class="font-bold" for="name">
        Name of person to invite
        <span class="font-normal text-xs">(Optional)</span>
      </label>
      <input
        id="name"
        type="text"
        )
        name="name"
        class="border-gray-300 border p-1 "
        placeholder="Name"
      />
    </div>
    <div class="mt-2 flex flex-col">
      <label class="font-bold" for="email">
        Email
      </label>
      <input
        id="email"
        type="text"
        name="email"
        class="border-gray-300 border p-1"
        placeholder="Email"
      />
    </div>
    <div class="mt-2 flex flex-col">
      <label class="font-bold" for="phone">
        Phone
      </label>
      <input
        id="phone"
        type="text"
        name="phone"
        class="border-gray-300 border p-1"
        placeholder="Phone"
      />
    </div>
    <p class="mt-1">
      <span class="font-bold">Email OR phone is required</span>
    </p>

    <div class="mt-2">
      <button class="p-1 bg-black text-white hover:underline" type="submit">
        Invite
      </button>
    </div>
  </form>
  <div class="sm:flex">
    <div class="flex-1">
      <%if(canRSVP){%>

      <div class="my-2" id="rsvp-message" data-turbolinks-permanent>
	      <%-include("partials/form_messages", {id:"rsvp"})%>
      </div>
      <div class="<%=_className("hidden", !invite.status || invite.status === "invited")%>" data-target="event-detail.hasRSVP">
	You RSVP'd as <%=invite.status%> - <button class="hover:underline text-blue-500" data-action="event-detail#changeRSVP">Change</button>
      </div>
        <form
          data-target="event-detail.rsvpForm"
	  class="mt-2 bg-gray-200 p-2 <%=_className("hidden", invite.status && invite.status !== "invited")%>"
          data-action="change->event-detail#rsvp"
          autocomplete="off"
        >
          <h4 class="text-lg font-bold">RSVP</h4>
          <input type="hidden" name="eventId" value="<%=event.id%>" />
          <div>
            <label class="font-bold"
              >Name <input type="text" name="name" value="<%=locals.user ?
              user.name : ""%>" class="border-gray-600 border p-1 w-full"
              placeholder="name" />
            </label>
          </div>

          <div class="mt-3">
            <fieldset>
              <legend
                class="font-lg text-gray-800 mb-1 font-bold"
                aria-label="RSVP Status"
              >
                Status
              </legend>
              <label class="font-bold cursor-pointer">
                <span class="">Going</span> <input type="radio" name="rsvp"
                value="going" <%=_checked(invite.status === "going")%>/>
              </label>
              -
              <label class="font-bold cursor-pointer">
                <span class="">Maybe</span> <input type="radio" name="rsvp"
                value="maybe" <%=_checked(invite.status === "maybe")%>/>
              </label>
              -

              <label class="font-bold cursor-pointer">
                <span class="">Not Going</span> <input type="radio" name="rsvp"
                value="declined" <%=_checked(invite.status === "declined") %>/>
              </label>
            </fieldset>
          </div>
          <div class="mt-1">
            <label class="cursor-pointer">
              Keep my RSVP private <input type="checkbox" name="show_name"
	      <%=_checked(invite && invite.status !== "invited" ? !invite.show_name : !event.is_private) %>
              />
            </label>
            <p>
              <span
                class="text-xs font-bold"
                data-target="event-detail.privateInfo"
                >Only the organizer will see your RSVP</span
              >
            </p>
          </div>
        </form>
      <%}%> <%if(!event.is_private){%>
      <div class="mt-2" id="twitter-section" data-turbolinks-permanent>
        <a
          href="https://twitter.com/share?ref_src=twsrc%5Etfw"
          class="twitter-share-button"
          data-text="<%=event.name%>"
          data-show-count="false"
          >Tweet</a
        ><script
          async
          src="https://platform.twitter.com/widgets.js"
          charset="utf-8"
          id="twitter-js"
          data-turbolinks-permanent
        ></script>
      </div>
      <%}%>
      <div class="mt-2">
        Created by: <%=event.creator.name%>
      </div>
      <div>
	      <p>
        <%=event.is_private ? "Private": "Public"%> event
	      </p>
	      <%if(isCreator){%>
	      <p class="mt-1 mb-1">
	      <span class="bg-yellow-400 p-1 text-xs text-yellow-900 font-bold">
	<%if(event.is_private){%>
		This event is private. Only you and the people you invite can see it.
	<%}else{%>
	This event is public. Anyone can see it. It can appear on the homepage.
	<%}%>
	      </span>
	      </p>
	      <%}%>
      </div>
      <hr />
      <div class="mt-2">
        <%(event.description || "").split("\n").forEach((line)=>{%>
        <p><%=line%></p>
        <%})%>
      </div>
    </div>
    <%if(canSeeInvites){%>
    <div
      class="sm:w-1/4 sm:ml-5 p-2 sm:border-l border-gray-300 sm:pl-5 mt-5 sm:mt-0"
    >
      <%-include("partials/form_messages", {id: "resend"} )%>
      <h3 class="text-lg">Invites</h3>
      <%["going", "invited", "maybe", "declined"].forEach((status)=>{%>
      <div class="border-b border-gray-300 pb-4 mt-2">
        <h4 class="italic">
          <%=status.charAt(0).toUpperCase() + status.substring(1)%>
        </h4>
        <%if(event[status].length){%>

        <ul class="list-disc pl-4">
          <%event[status].forEach((invite)=>{%> <%const person = invite.user%>
          <%const name = person.name || person.email || person.phone%> <%if(name
          && name.trim()){%>
          <li>
            <span><%=name%></span>
            <%if(canInvite){%>
            <button
              class="text-blue-500 hover:underline"
              data-id="<%=invite.id%>"
              data-action="event-detail#resend"
            >
              Resend Invite
            </button>
            <%}%>
          </li>
          <%}%> <%})%>
        </ul>
        <%} else {%>
        <p class="ml-5 text-xs text-gray-700">---</p>
        <%}%>
      </div>
      <%})%>
    </div>
    <%}%>
  </div>
</div>
