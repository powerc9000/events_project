<div class="container mx-auto content" data-controller="event-detail">
  <ul class="flex border-b border-gray-800 text-md my-4">
    <li class="-mb-px mr-1 pl-2">
      <a
        class="bg-white inline-block border-l border-t border-r rounded-t py-2 px-4 text-blue-700 font-semibold border-gray-800"
        href="<%=path%>"
        >Event Details</a
      >
    </li>
    <li class="mr-1">
      <a
        class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold"
        href="<%=path%>/discussion"
        >Discussion</a
      >
    </li>
  </ul>
  <div class="flex items-center">
    <h1 class="font-bold text-3xl"><%=event.name%></h1>
    <div class="ml-4">
      <%if(canEdit){%>
      <a href="<%=path%>/edit" class="text-blue-700 hover:underline">Edit</a>
      <%}%>
    </div>
  </div>
  <%if(event.location){%>
  <h2 class="text-lg" aria-label="Location" title="Location">
    <i class="fas fa-map-marker-alt" aria-hidden="true"></i
    ><span class="ml-2"><%=event.location%></span>
  </h2>
  <%}%>
  <div class="text-lg" aria-label="Time">
    <i class="fas fa-calendar-day"></i>
    <span
      data-controller="format-date"
      data-format-date-epoch="<%=event.date%>"
      data-target="format-date.date"
      ><%=new Date(event.date)%></span
    >
  </div>

  <div class="sm:flex">
    <div class="flex-1">
      <%- include ./partials/event_detail/invite_to_event %> <%if(canRSVP){%>

      <div class="my-2" id="rsvp-message" data-turbolinks-permanent>
        <%-include("./partials/form_messages", {id:"rsvp"}) %>
      </div>
      <div
        class="<%=_className('hidden', !invite.status || invite.status === 'invited')%>"
        data-target="event-detail.hasRSVP"
      >
        You RSVP'd as <%=invite.status%> -
        <button
          class="hover:underline text-blue-700"
          data-action="event-detail#changeRSVP"
        >
          Change
        </button>
      </div>
      <form
        data-target="event-detail.rsvpForm"
        class="mt-2 bg-gray-200 p-2 <%=_className('hidden', invite.status && invite.status !== 'invited')%>"
        data-action="change->event-detail#rsvp reset->event-detail#toggleRSVP"
        autocomplete="off"
      >
        <h4 class="text-lg font-bold">RSVP</h4>
        <input type="hidden" name="eventId" value="<%=event.id%>" />
        <div>
          <label class="font-bold"
            >Name <input type="text" name="name" value="<%=locals.user ?
            user.name : ""%>" class="border-gray-600 border p-1 w-full"
            placeholder="name" />
          </label>
        </div>

        <div class="mt-3">
          <fieldset>
            <legend
              class="font-lg text-gray-800 mb-1 font-bold"
              aria-label="RSVP Status"
            >
              Status
            </legend>
            <label class="font-bold cursor-pointer">
              <span class="">Going</span> <input type="radio" name="rsvp"
              value="going" <%=_checked(invite.status === 'going')%>/>
            </label>
            -
            <label class="font-bold cursor-pointer">
              <span class="">Maybe</span> <input type="radio" name="rsvp"
              value="maybe" <%=_checked(invite.status === 'maybe')%>/>
            </label>
            -

            <label class="font-bold cursor-pointer">
              <span class="">Not Going</span> <input type="radio" name="rsvp"
              value="declined" <%=_checked(invite.status === 'declined') %>/>
            </label>
          </fieldset>
        </div>
        <div class="mt-1">
          <label class="cursor-pointer">
            Keep my RSVP private <input type="checkbox" name="show_name"
            <%=_checked(invite && invite.status !== 'invited' ?
            !invite.show_name : !event.is_private) %> />
          </label>
          <p>
            <span
              class="text-xs font-bold"
              data-target="event-detail.privateInfo"
              >Only the organizer will see your RSVP</span
            >
          </p>
        </div>
        <div>
          <button
            type="reset"
            class="btn btn-white <%=_className('hidden', !invite.status || invite.status === 'invited')%>"
          >
            Cancel
          </button>
        </div>
      </form>
      <%}%>
      <div class="mt-2">
        Created by: <%=event.creator.name%>
      </div>
      <div>
        <p>
          <%=event.is_private ? "Private": "Public"%> event
        </p>
        <%if(!event.is_private){%>
        <div class="my-1" id="twitter-section" data-turbolinks-permanent>
          <a
            href="https://twitter.com/share?ref_src=twsrc%5Etfw"
            class="twitter-share-button"
            data-text="<%=event.name%>"
            data-show-count="false"
            >Tweet</a
          ><script
            async
            src="https://platform.twitter.com/widgets.js"
            charset="utf-8"
            id="twitter-js"
            data-turbolinks-permanent
          ></script>
        </div>
        <%}%> <%if(isCreator){%>
        <p class="mt-1 mb-1">
          <span class="bg-yellow-400 p-1 text-xs text-yellow-900 font-bold">
            <%if(event.is_private){%> This event is private. Only you and the
            people you invite can see it. <%}else{%> This event is public.
            Anyone can see it. It can appear on the homepage. <%}%>
          </span>
        </p>
        <%}%>
      </div>

      <hr />
      <div class="mt-2 md mb-2">
        <details open>
          <summary>Description</summary>
          <%-mdDescription%>
        </details>
      </div>
      <hr class="sm:hidden" />
    </div>
    <div
      class="sm:w-1/4 sm:ml-5 p-2 sm:border-l border-gray-300 sm:pl-5 mt-5 sm:mt-0"
    >
      <%-include("partials/form_messages", {id: "resend"} )%>
      <h3 class="text-lg">Invites</h3>
      <%["going", "invited", "maybe", "declined"].forEach((status)=>{%>
      <div class="border-b border-gray-300 pb-4 mt-2">
        <h4 class="italic">
          <%=status.charAt(0).toUpperCase() + status.substring(1)%>
        </h4>
        <%if(canSeeInvites){%>
        <!-- prettier-ignore -->
        <%if(event[status].length){%>

        <ul class="list-disc pl-4">
          <!-- prettier-ignore -->
          <%let statusCount = 0%>
          <!-- prettier-ignore -->
          <%event[status].forEach((invite)=>{%>
          <!-- prettier-ignore -->
          <%const person = invite.user%>
          <!-- prettier-ignore -->
          <%const name = person.name || person.email || person.phone%>
          <!-- prettier-ignore -->
          <%if(name && name.trim() && (invite.show_name || isCreator ||
          invite.user.id === user.id)){%>
          <li>
            <span><%=name%></span>
            <%if(canInvite){%>
            <button
              class="text-blue-700 hover:underline"
              data-id="<%=invite.id%>"
              data-action="event-detail#resend"
            >
              Resend Invite
            </button>
            <%}%>
          </li>
          <%} else if(!invite.show_name && !isCreator){statusCount++}%> <%})%>
          <%if(statusCount){%> +<%=statusCount%> more people <%}%>
        </ul>
        <%} else {%>
        <p class="ml-5 text-xs text-gray-700">---</p>
        <%}%> <%} else {%> <%=event[status].length%> People <%}%>
      </div>
      <%})%>
    </div>
  </div>
</div>
